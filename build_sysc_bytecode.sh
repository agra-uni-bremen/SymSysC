#!/usr/bin/env bash

mkdir build && cd build

cmake -D CMAKE_C_COMPILER=clang -D CMAKE_CXX_COMPILER=clang++ -D CMAKE_CXX_FLAGS="-DUSE_KLEE -fcxx-exceptions -stdlib=libc++ -std=c++14 -emit-llvm -flto -c -Xclang -disable-O0-optnone" -D CMAKE_CXX_CREATE_STATIC_LIBRARY="llvm-link <CMAKE_CXX_LINK_FLAGS> <LINK_FLAGS> <OBJECTS> -o <TARGET> <LINK_LIBRARIES>" -D CMAKE_CXX_LINK_EXECUTABLE="llvm-link -only-needed <CMAKE_CXX_LINK_FLAGS> <LINK_FLAGS> <OBJECTS> <LINK_LIBRARIES> -o <TARGET>" -DCMAKE_LINKER=llvm-link -DCMAKE_BUILD_TYPE=Debug ..

make -j16   #expect linker error

cd src && llvm-link -o libsystemc.so.2.3.3 CMakeFiles/systemc.dir/sysc/communication/sc_clock.cpp.o CMakeFiles/systemc.dir/sysc/communication/sc_event_finder.cpp.o CMakeFiles/systemc.dir/sysc/communication/sc_event_queue.cpp.o CMakeFiles/systemc.dir/sysc/communication/sc_export.cpp.o CMakeFiles/systemc.dir/sysc/communication/sc_interface.cpp.o CMakeFiles/systemc.dir/sysc/communication/sc_mutex.cpp.o CMakeFiles/systemc.dir/sysc/communication/sc_port.cpp.o CMakeFiles/systemc.dir/sysc/communication/sc_prim_channel.cpp.o CMakeFiles/systemc.dir/sysc/communication/sc_semaphore.cpp.o CMakeFiles/systemc.dir/sysc/communication/sc_signal.cpp.o CMakeFiles/systemc.dir/sysc/communication/sc_signal_ports.cpp.o CMakeFiles/systemc.dir/sysc/communication/sc_signal_resolved.cpp.o CMakeFiles/systemc.dir/sysc/communication/sc_signal_resolved_ports.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/bit/sc_bit.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/bit/sc_bv_base.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/bit/sc_logic.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/bit/sc_lv_base.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/fx/sc_fxcast_switch.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/fx/sc_fxdefs.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/fx/sc_fxnum.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/fx/sc_fxnum_observer.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/fx/sc_fxtype_params.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/fx/sc_fxval.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/fx/sc_fxval_observer.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/fx/scfx_mant.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/fx/scfx_pow10.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/fx/scfx_rep.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/fx/scfx_utils.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/int/sc_int_base.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/int/sc_int_mask.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/int/sc_length_param.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/int/sc_nbexterns.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/int/sc_nbutils.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/int/sc_signed.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/int/sc_uint_base.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/int/sc_unsigned.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/misc/sc_concatref.cpp.o CMakeFiles/systemc.dir/sysc/datatypes/misc/sc_value_base.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_attribute.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_cor_fiber.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_cor_pthread.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_cor_qt.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_cthread_process.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_event.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_except.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_join.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_main.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_main_main.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_method_process.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_module.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_module_name.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_module_registry.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_name_gen.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_object.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_object_manager.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_phase_callback_registry.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_process.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_reset.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_sensitive.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_simcontext.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_spawn_options.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_thread_process.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_time.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_ver.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_wait.cpp.o CMakeFiles/systemc.dir/sysc/kernel/sc_wait_cthread.cpp.o CMakeFiles/systemc.dir/sysc/tracing/sc_trace.cpp.o CMakeFiles/systemc.dir/sysc/tracing/sc_trace_file_base.cpp.o CMakeFiles/systemc.dir/sysc/tracing/sc_vcd_trace.cpp.o CMakeFiles/systemc.dir/sysc/tracing/sc_wif_trace.cpp.o CMakeFiles/systemc.dir/sysc/utils/sc_hash.cpp.o CMakeFiles/systemc.dir/sysc/utils/sc_list.cpp.o CMakeFiles/systemc.dir/sysc/utils/sc_mempool.cpp.o CMakeFiles/systemc.dir/sysc/utils/sc_pq.cpp.o CMakeFiles/systemc.dir/sysc/utils/sc_report.cpp.o CMakeFiles/systemc.dir/sysc/utils/sc_report_handler.cpp.o CMakeFiles/systemc.dir/sysc/utils/sc_stop_here.cpp.o CMakeFiles/systemc.dir/sysc/utils/sc_string.cpp.o CMakeFiles/systemc.dir/sysc/utils/sc_utils_ids.cpp.o CMakeFiles/systemc.dir/sysc/utils/sc_vector.cpp.o CMakeFiles/systemc.dir/tlm_core/tlm_2/tlm_generic_payload/tlm_gp.cpp.o CMakeFiles/systemc.dir/tlm_core/tlm_2/tlm_generic_payload/tlm_phase.cpp.o CMakeFiles/systemc.dir/tlm_core/tlm_2/tlm_quantum/tlm_global_quantum.cpp.o CMakeFiles/systemc.dir/tlm_utils/convenience_socket_bases.cpp.o CMakeFiles/systemc.dir/tlm_utils/instance_specific_extensions.cpp.o